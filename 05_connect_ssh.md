# SSH接続する

これまでブラウザのコンソール上でVPSを操作していましたが、ブラウザでさくらVPSにログインして...サーバーを選んで...コンソールを開いて...というのはちょっと手間だったと思います。この章ではご自身のPCからVPSに対して「SSHログイン」を行い、ブラウザよりも気軽にVPSに入れるようにしたいと思います。

## パスワードでSSHログインする

ssh接続にはVPSを建てる時に設定したubuntuユーザーのパスワードでログインする方法と、「公開鍵認証」というやり方でログインする方法の2種類があります。

### Macの場合

macで「ターミナル」というアプリを開きます。

![ターミナル](./assets/05/01.jpg)

そこで `ssh ubuntu@{あなたのvpsのipアドレス}`を入力してEnter。

![sshコマンドを実行](./assets/05/02.jpg)


☝️何か聞かれますが `yes` と入れてEnter。

![ubuntuユーザーのパスワードを要求される](./assets/05/03.jpg)

☝️VPSのubuntuユーザーのパスワードを入れます。

![sshログイン成功](./assets/05/04.jpg)

コマンドを入力するところの表示が`ubuntu@~~~`に変わったら成功です。

![コマンドが実行可能に](./assets/05/05.jpg)

ターミナル上でlinuxコマンドを実行することができます。

### Windowsの場合
※画面はWindows10です

PowerShellを開きます

![powershellを開く](./assets/05/06.png)

`C:\Windows\System32\OpenSSH\ssh ubuntu@{あなたのvpsのipアドレス}`を入力してEnter。

![sshコマンドを実行](./assets/05/07.png)

☝️VPSのubuntuユーザーのパスワードを入れます。

![sshコマンドを実行](./assets/05/08.png)

コマンドを入力するところの表示が`ubuntu@~~~`に変わったら成功です。

## 公開鍵でSSHログインする

前半ではパスワードでsshログインをしていましたが、実はパスワードでのログインはセキュリティ上あまり良くないとされています。理由は総当たりでパスワードを試行すれば頑張れば悪意のある第三者にログインされてしまう可能性があるからです。

試しにコンソール上で `tail -f  /var/log/auth.log`と実行してみてください。

![tail -f /var/log/auth.log](./assets/05/09.jpg)

何やらずらずらと「ログ」が流れていっていると思います。実はこれどこかの誰かがこのVPSにsshログインをしようと試みている証です笑
（画面は`control+C`で戻せます）

このようにサーバーというのは常に悪意ある人たちの脅威に晒されているので、もう少しこのVPSのセキュリティを高めたいと思います。その時に用いるのが「公開鍵」です。
（「公開鍵認証」については色々なところで解説されているので調べてみてください。）

### 公開鍵の生成（Mac）
※これらの操作はVPS上ではなくローカルマシン上で行います

ターミナルで`ssh-keygen`と入力。

![tail -f /var/log/auth.log](./assets/05/10.jpg)

すると鍵のファイル名を尋ねられます。何も入力せずにEnterを押せば括弧内のファイル名（この例で言えば`/Users/hayakawa/.ssh`というディレクトリに`id_ed25519`というファイル名）で作成されます。今回はファイル名を`sakura`としました。（パスを指定していないとコマンドを実行した時のカレントディレクトリ直下に作成されてしまうので注意）

![tail -f /var/log/auth.log](./assets/05/11.jpg)

続いて「パスフレーズ」の設定を求められます。何も入力せずにEnterを押せば"パスフレーズなし"という扱いになりますが、セキュリティのため任意のパスフレーズを入れておきましょう。

![tail -f /var/log/auth.log](./assets/05/12.jpg)

最後に何やら図形っぽいもの（「ランダムアート」）が表示されたら成功です。

### 公開鍵の生成（Windows）
※これらの操作はVPS上ではなくローカルマシン上で行います

※画面はWindows10です

PowerShellで`C:\Windows\System32\OpenSSH\ssh-keygen`と入力してEnter。
以降は☝️のmacのやり方と同様です。

![tail -f /var/log/auth.log](./assets/05/13.png)

